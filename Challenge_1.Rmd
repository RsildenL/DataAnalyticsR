---
title: "Challenge 1: General Overview and Data Treatment"
subtitle: "Data Analytics with R"
author: "Rebecca Silden Langlo, Afonso Penalva & others" 
date: "2/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
```


```{r}
machine_data <- fread("Data/machine_data.csv")
product_data <- fread("Data/product_data.csv")
 # we all need to include the transactional_data file in the Data folder, but we can't push it to the git repository
transaction_data <- fread("Data/transactional_data.csv")
```


## Question 1: General overview of the data
### Machines
```{r}
number_of_machines <- uniqueN(machine_data$machine)
number_of_machines
```
```{r}
machine_dist <- machine_data[,.(.N), by=small_machine]
machine_dist[,percent := N/number_of_machines]

machine_dist$type <- ifelse(machine_dist$small_machine == 1, 
                            yes = "small", no = "large")
machine_dist
```
```{r}
machine_dist_by_location <- machine_data[,.(.N),by = .(small_machine, location_type)]
machine_dist_by_location [,percent := N/number_of_machines]

machine_dist_by_location$type <- ifelse(machine_dist_by_location$small_machine == 1,
                            yes = "small", no = "large")
machine_dist_by_location
```

### Products 
```{r}

product_names <- unique(product_data$product_name)
number_of_products <- uniqueN(product_data$product_name)

product_dist <- product_data[,.(.N, mean_price = mean(price)), by=category]

number_of_products; product_dist
```


### Transactional data
```{r}
library("openair")
transaction_data$date <- as.Date(transaction_data$date)
transactions_march <- selectByDate(transaction_data, year = 2017, month = 3)
```


```{r}
transactions_march_dist <- transactions_march[, .(.N), by=.(machine, date)]

uniqueN(transactions_march_dist$machine)
uniqueN(transactions_march_dist$date)

sales_dist <- transactions_march_dist[,.(mean_sales = mean(N)), by=machine]
sales_dist <- merge(sales_dist, machine_data[,.(machine, small_machine)], by.x = "machine", by.y= "machine")
sales_dist

sales_dist2 <- sales_dist[,.(avg_sales = mean(mean_sales)), by = small_machine]
sales_dist2
```





## Question 2: Plot interpretation 
a. Is there a general trend in the number of snacks and drinks as the months progress from January to April? Is it the same for snacks and drinks? Why do you think that
might be so?

b. Is there shorter time period trend as well? Is it the same for snacks and drinks? What do you think might be the cause?


### Question 3: Distribution of income 



### Question 4: Boxplot interpretation 



### Question 5: Location score
In this exercise we will build a location score that tells us what’s the average
daily items per machine depending on the location it is placed. This model could be used to 
a) Decide in which locations to place new machines 
b) Construct a benchmark for each machine: how much should it sell according to its location? This can be used to detect problems in machines (i.e. illumination, bad placement within a station etc.)


#### Significant variables
Do all variables show statistical significance? Which ones doesn’t? How do you know?
Hint: Recall that to check the parameters of a glm model called “model1” you need
to run summary(model1)

```{r}

```


#### Linear model 
Build another linear model but this time instead of using the variables
“total_number_of_routes_600 use the log of that variable in base 10 calling it
“log_transport”. Does this new variable show statistical significance?
```{r}

```


#### How many daily items less do small machines sell all other factors remaining equal?
```{r}

```

#### What’s effect on machine sales does having other nearby machines all other factors remaining equal?
```{r}

```

#### Top and bottom ratio
Ranking all machines according to the final_model, what are the real daily sales of the top20% machines with respect to your model prediction? And the real daily sales of the bottom20% machines according to your model? What’s the
top20%/bottom20% ratio?



#### Choice
Given the following 2 locations for a big machine:
i. Supermarket entrance, 2 nearby hotels of 4 stars, 20 transport routes, no
nearby machines
ii. Transport station, no nearby hotels of 4 or 5 stars, 10 transport routes
nearby, 3 nearby Vendex machines
Which location would you choose and why?

